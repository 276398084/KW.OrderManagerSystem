@model KeWeiOMS.Domain.AccountType
@{
    Layout = null;
}

<script type="text/javascript">
    $(function () {
        $('#c_Platform').combotree({
            url: '/Home/Platform',
            valueField: 'id',
            textField: 'text',
            required: true,
            width: 150,
           onChange: pChange
        });
        $('#c_Platform').combotree("setValue", "Ebay");
        pChange('Ebay', "");
    });

    function pChange(n, o) {
        $('#tr1').hide();
        $('#tr2').hide();
        $('#tr3').hide();
        $('#btnEbayLogin').hide();
        $('#btnEbayToken').hide();
        $('#btnAliLogin').hide();
        if (n == "Ebay") {
            $('#tr3').show();
            $('#btnEbayLogin').show();
            $('#btnEbayToken').show();
        }
        if (n == "SMT") {
            $('#tr3').show();
            $('#btnAliLogin').show();
        }
    }
    var code = "";
    function aliLogin() {
        jQuery.ajax({
            url: "/Account/GetAliLoginUrl",
            type: "post",
            success: function (res) {
                if (res.IsSuccess) {
                  
                    window.open(res.Result);
                } else {
                    alert(res.ErrorMsg);
                }
            }
        });
    }
    
    function ebayLogin() {
        jQuery.ajax({
            url: "/Account/GetEbayLoginUrl",
            type: "post",
            success: function (res) {
                if (res.IsSuccess) {
                    code = res.Code;
                  
                    window.open(res.Result);
                } else {
                    alert(res.ErrorMsg);
                }
            }
        });
    }
    
    function getEbaySession() {
        jQuery.ajax({
            url: "/Account/GetEbaySession",
            type: "post",
            data:'o='+code,
            success: function (res) {
                if (res.IsError) {
                    alert(res.Message);
                } else {
                    $('#c_ApiToken').val(res.Result);
                }
            }
        });
    }
</script>
@using (Html.BeginForm("Create", "Account", FormMethod.Post, new { id = "c_form" }))
{
    <fieldset>
        <table class="editForm">
            <tr>
                <td>
                    @Html.LabelFor(model => model.AccountName, "账户名称:")
                </td>
                <td>
                    @Html.TextBoxFor(model => model.AccountName, new { @id = "c_AccountName" })
                </td>
            </tr>

            

            <tr id="tr1">
                <td>
                    @Html.LabelFor(model => model.ApiKey, "APIKey:")
                </td>
                <td>
                    @Html.TextBoxFor(model => model.ApiKey, new { @id = "c_ApiKey" })
                </td>
            </tr>

            <tr id="tr2">
                <td>
                    @Html.LabelFor(model => model.ApiSecret, "API密钥:")
                </td>
                <td>
                    @Html.TextBoxFor(model => model.ApiSecret, new { @id = "c_ApiSecret" })
                </td>
            </tr>

            <tr id="tr3">
                <td>
                    @Html.LabelFor(model => model.ApiToken, "APIToken:")
                </td>
                <td>
                    @Html.TextBoxFor(model => model.ApiToken, new { @id = "c_ApiToken" })
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type="button" id="btnEbayLogin" onclick="ebayLogin()" value="ebay登录" />
                    <input type="button" id="btnEbayToken" onclick="getEbaySession()" value="获得Token" />
                    <input type="button" id="btnAliLogin" onclick="aliLogin()" value="获得Token" />
                </td>
            </tr>

            <tr>
                <td>
                    @Html.LabelFor(model => model.Platform, "平台:")
                </td>
                <td>
                    @Html.TextBoxFor(model => model.Platform, new { @id = "c_Platform" })
                </td>
            </tr>

        </table>
    </fieldset>
}
