@model IEnumerable<KeWeiOMS.Domain.LogisticsType>
@{
    ViewBag.Title = "Index";
}
<script src="@Url.Content("~/Scripts/easyUI/datagrid-detailview.js")"></script>
<body class="easyui-layout">
    <script language="javascript" type="text/javascript">
        $(function () {
            $('#dg').datagrid({
                url: '@Url.Action("List", "Logistics")',
                pageNumber: 1,
                pageSize: 20,
                pageList: [20, 40, 60, 80, 100],
                view: detailview,
                columns: [[
                   { field: 'LogisticsName', title: '������', width: 100 ,sortable:true},
                   { field: 'LogisticsCode', title: '�����̴���', width: 100, sortable: true },
                   {
                       field: 'HasTrackCode', title: '�Ƿ���׷����', width: 100,sortable:true, formatter: function (value) {
                           if (value == "1")
                               return "��";
                           else
                               return "��";
                       }
                   },
                   { field: 'CodeLength', title: '׷���볤��', width: 100, sortable: true },
                   {
                       field: 'ReMark', title: '��ע', width: 100, sortable: true
                   },
                   {
                       field: 'Id', title: '����', width: 200, formatter: function (value) {
                           return '<a href=\'javascript:void(0)\' class=\'easyui-linkbutton\' plain=\'true\' onclick=\'del(' + value + ')\'>ɾ��</a> <a href=\'javascript:void(0)\' class=\'easyui-linkbutton\' plain=\'true\' onclick=\'addMode(' + value + ')\'>�����ϸ</a>  <a href=\'javascript:void(0)\' class=\'easyui-linkbutton\' plain=\'true\' onclick=\'seeArea(' + value + ')\'>�鿴����</a>';
                       }
                   }
                ]],
                detailFormatter: function (index, row) {
                    return '<div style="padding:2px"><table id="ddv-' + index + '" style="padding:5px 0"></table></div>';
                },
                onExpandRow: function (index, row) {
                    $('#ddv-' + index).datagrid({
                        fitColumns: true,
                        singleSelect: true,
                        rownumbers: true,
                        loadMsg: '',
                        height: 'auto',
                        url: '@Url.Action("GetMode", "LogisticsMode")' + "/" + row.Id,
                        columns: [[
                                { field: 'LogisticsName', title: '������', width: 200 },
                                { field: 'LogisticsCode', title: '�����̴���', width: 100 },
                                {field: 'Discount', title: '�ۿ�', width: 100},
                               {
                                   field: 'Id', title: '����', width: 100, formatter: function (value) {
                                       return '<a href=\'javascript:void(0)\' class=\'easyui-linkbutton\' plain=\'true\' onclick=\'delMode(' + value + ')\'>ɾ��</a> <a href=\'javascript:void(0)\' class=\'easyui-linkbutton\' plain=\'true\' onclick=\'editMode(' + row.Id + ',' + value + ')\'>�޸�</a>';
                                   }
                               }

                        ]],
                        onResize: function () {
                            $('#dg').datagrid('fixDetailRowHeight', index);
                        },
                        onLoadSuccess: function () {
                            setTimeout(function () {
                                $('#dg').datagrid('fixDetailRowHeight', index);
                            }, 0);
                        }
                    });
                    $('#dg').datagrid('fixDetailRowHeight', index);
                }
            });




        });


        //�½�
        function c_dlg() {
            var url_str = '@Url.Action("Create", "Logistics")';
            showdlg(url_str, 'c_dlg', ajaxAdd)
        }

        //�༭��
        function e_dlg() {
            var url = '@Url.Action("Edit", "Logistics")/' + id;
        if (id != undefined) {
            var url = '@Url.Action("Edit", "Module")/' + id;
            showdlg(url, 'e_dlg', ajaxEdit)
        }
    }

    //�첽�½��ύ
    function ajaxAdd() {
        formPost('c_form', '@Url.Action("Create", "Logistics")', 'c_dlg', 'dg');
        }
        //�첽�޸��ύ
        function ajaxEdit() {
            formPost('e_form', '@Url.Action("Edit", "Logistics")', 'e_dlg', 'dg');
        }
        //ɾ��
        function del(id) {
            if (id != undefined) {

                delData('@Url.Action("Delete", "Logistics")/' + id, 'dg');

            }
        }

        //��ȡѡ����
        function getselectedRow() {
            var row = $('#dg').datagrid('getSelected');
            if (row != undefined) {
                if (row.hasOwnProperty('Id')) {
                    var id = row['Id'];
                    return id;
                }
            }
            $.messager.show({
                title: '��ʾ',
                msg: '��ѡ����',
                timeout: 3000,
                showType: 'slide'
            });
            return (undefined);
        }

        function seeArea(id) {
            window.open('@Url.Action("Index", "LogisticsArea")?id=' + id)
        }
        //�����ϸ
        function addMode(id) {
            var url_str = '@Url.Action("Create", "LogisticsMode")?id=' + id;
            showdlg(url_str, 'm_dlg', ajaxAddM)
         }
        function ajaxAddM() {
            formPost('m_form', '@Url.Action("Create", "LogisticsMode")', 'm_dlg', 'modedg');
            $("#dg").datagrid("reload");
        }
        //�޸���ϸ
        function editMode(pid,id) {
            var url_str = '@Url.Action("Edit", "LogisticsMode")?id=' + id;
            showdlg(url_str, 'me_dlg', ajaxUpdM)
        }
        function ajaxUpdM() {
            formPost('me_form', '@Url.Action("Edit", "LogisticsMode")', 'me_dlg', 'modedg');
            $("#dg").datagrid("reload");
        }
        //ɾ����ϸ
        function delMode(id) {
            if (id != undefined) {
                var url = '@Url.Action("Delete", "LogisticsMode")/' + id;
                delData(url,'dg');
            }
        }

        function doSearch() {
            search = $('#txtSearch').searchbox("getName") + "&" + $('#txtSearch').searchbox("getValue") + "^";
            $("#dg").datagrid("load", {
                search: search

            });
        }
    </script>
    <div region="center">
        <table id="dg" class="easyui-datagrid"
            toolbar="#toolbar"
            rownumbers="true" fitcolumns="true" singleselect="true" pagination="true" fit="true">
            @*        <thead>  
        <tr>
            <th field="Id" width="100">
                ����
            </th>

            <th field="LogisticsName" width="100">
                ����������
            </th>

            <th field="LogisticsCode" width="100">
                �����̴���
            </th>

            <th field="HasTrackCode" width="100">
                �Ƿ���׷����
            </th>

            <th field="CodeLength" width="100">
                ׷���볤��
            </th>

            <th field="Remark" width="100">
                ��ע
            </th>

            <th field="CreateOn" width="100">
                ���ʱ��
            </th>


    	</tr>
		</thead>*@

        </table>
        <div id="toolbar">
            <a href="#" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="c_dlg();">�½�</a>
            @*        <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="e_dlg()">�༭</a>  
        <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="del();">ɾ��</a>  *@
            <input id="txtSearch" class="easyui-searchbox" data-options="prompt:'��ѯ�ؼ���',searcher:doSearch,menu:'#mm'"></input>
        </div>
        <div id="mm" style="width: 120px">
            <div data-options="name:'LogisticsName'">����������</div>
            <div data-options="name:'LogisticsCode'">�����̴���</div>
            <div data-options="name:'CodeLength'">׷���볤��</div>
            <div data-options="name:'Remark'">��ע</div>
            <div data-options="name:'CreateOn'">���ʱ��</div>
        </div>

        <div id="c_dlg"></div>
        <div id="e_dlg"></div>
        <div id="m_dlg"></div>
        <div id="me_dlg"></div>
    </div>
</body>
